# QEMU Section Readme

this folder is for stuff needed to emulate the device

## Folder Structure
### Scripts
- `run_qemu.sh` starts a qemu vm (can use `-initrd` flag to use intird image, otherwise needs image generated by `create_rootfs_image.sh`)
- `run_qemu_usermode.sh` can run individual binaries emulating the XBurstR2 CPU
- `create_rootfs_image.sh` (requires sudo) bundles squashfs-root into an ext4 image for use with `run_qemu.sh`

### Other Files
- `initrd.cpio`, this is the initrd image for `run_qemu_initrd.sh`
- `rootfs-image`, this is the rootfs image for `run_qemu.sh`

## Current Debug Method
In order to get the kernel output from qemu youll need to use `gdb` (the GNU Debug Tool)
The outputs from this debugging have been put into the logs directory for analysis after being cleaned (there were a lot of useless lines)

1. run `run_qemu.sh` to start the vm
2. run `gdb Linux-4.4.94+.elf` (you might need to change the path to the elf depending on your current directory). this opens up the gdb tool analyzing the kernel
3. now that you're in the gdb tool, run `target remote :1234`
4. run `continue`. wait for a pretty long while (like 10-30 seconds in my testing)
5. after a while it usually panics and automatically finishes the continue command. if it's been a long time it probably did panic but didnt stop the command for some reason
6. run `x/2000s __log_buf`, then type "c" and press enter to let it print out the whole log. this should show the kernel log, and end with a traceback from a panic. if it just ends at `random: nonblocking pool is initialized"`, then you probably didnt let it continue long enough.
7. save that log, it's useful. probably get rid of all the empty lines though
8. run `bt` to get a simple backtrace. ive not found it useful yet. but more info is more info.
